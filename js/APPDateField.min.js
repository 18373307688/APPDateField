(function(){"use strict";var t=this,e={fontSize:22,step:40,isCircle:!0,tpl:'<div class="app-dateField-main"><div class="app-dateField-top"><span class="app-dateField-btnCancel">取消</span><span class="app-dateField-title">选择时间</span><span class="app-dateField-btnOk">完成</span></div><div class="app-dateField-center"><ul class="app-dateField-year-con"></ul><ul class="app-dateField-month-con"></ul><ul class="app-dateField-date-con"></ul><div class="app-center-current"></div></div><div class="app-dateField-bottom"></div></div>'},s=function(t,s,a,o){var i=this,s=s||{};i.selectElm="string"==typeof t?document.getElementById(t):t,i.htmlDom=null,i.appWrap=$?$("#APPDateField-con")[0]:document.getElementById("APPDateField-con"),i.loaded=!1,i.isRender=!1,(s.complate&&void 0!=s.complate&&"function"==typeof s.complate||a&&"function"==typeof a)&&(i.complate=s.complate?s.complate:a),(s.cancel&&void 0!=s.cancel&&"function"==typeof s.cancel||o&&"function"==typeof o)&&(i.cancel=s.cancel?s.cancel:o),i.currentTop=0,i.step=e.step,i.valList=[],i.currDate=[],i.app_top,i.app_btnCancel,i.app_btnOk,i.app_center_con,i.app_y_con,i.app_m_con,i.app_d_con,i.app_cen_c,i.opts={year:(new Date).getFullYear(),month:(new Date).getMonth()+1,date:(new Date).getDate(),hours:(new Date).getHours(),minutes:(new Date).getMinutes(),seconds:(new Date).getSeconds(),upYear:s.upYear||60,downYear:"number"==typeof s.downYear?s.downYear:60,isCN:s.isCN||void 0==s.isCN?!0:s.isCN,isListType:s.isListType||void 0==s.isListType?!0:s.isCN,isVal:s.isVal||void 0==s.isVal?!1:s.isVal,isCircle:s.isCircle||void 0==s.isCircle?!0:s.isCircle,showYear:s.showYear||void 0==s.showYear?!0:s.showYear,showMonth:s.showMonth||void 0==s.showMonth?!0:s.showMonth,showDate:s.showDate||void 0==s.showDate?!0:s.showDate,showTime:s.showTime||!1,commer:s.commer||"-"},e.isCircle=i.opts.isCircle,i.opts.step&&(e.step=i.opts.step),i._init()};s.prototype._init=function(){var t=this,e="";e="INPUT"==t.selectElm.tagName?t.selectElm.value:t.selectElm.innerHTML,(e||""!==e)&&(t.valList=t.subDefaultDate(e||"")),t.setCurrentTXT(t.valList),t.appWrap?($?$(t.appWrap).fadeIn(0):t.appWrap.style.display="block",t.isRender=!0):(t.appWrap=document.createElement("div"),t.appWrap.setAttribute("id","APPDateField-con"),t.appWrap.setAttribute("class","APPDateField-con"),document.body.appendChild(t.appWrap)),t._load()},s.prototype._load=function(){var t=this;t._render()},s.prototype._render=function(){var t=this,s=$(t.appWrap).html(e.tpl);t.htmlDom=s,t.app_main=s.find(".app-dateField-main"),t.app_top=s.find(".app-dateField-top"),t.app_btnCancel=s.find(".app-dateField-btnCancel"),t.app_btnOk=s.find(".app-dateField-btnOk"),t.app_center_con=s.find(".app-dateField-center"),t.app_y_con=s.find(".app-dateField-year-con"),t.app_m_con=s.find(".app-dateField-month-con"),t.app_d_con=s.find(".app-dateField-date-con"),t.app_cen_c=s.find(".app-center-current"),t.app_center_con.find("ul").css({width:s.width()/3}),t.opts.showYear&&t.opts.showMonth&&!t.opts.showDate?(t.app_center_con.find("ul").css({width:s.width()/2}),t.app_y_con.css({left:0}),t.app_m_con.css({left:s.width()/2}),t.app_d_con.css({left:s.width()/2*2,display:"none"})):!t.opts.showYear&&t.opts.showMonth&&t.opts.showDate?(t.app_center_con.find("ul").css({width:s.width()/2}),t.app_y_con.css({left:0,display:"none"}),t.app_m_con.css({left:0}),t.app_d_con.css({left:s.width()/2})):t.opts.showYear&&t.opts.showMonth&&t.opts.showDate&&(t.app_y_con.css({left:0}),t.app_m_con.css({left:s.width()/3}),t.app_d_con.css({left:s.width()/3*2})),t.loaded=!0,t.opts.showTime?(t.createHours(),t.createMins(),t.createSeconds()):(t.createYear(),t.createMonth(),t.createDate()),t._events()},s.prototype.createYear=function(t,e){var s=this,t=t||s.opts.upYear,e=e||s.opts.downYear,a=new Date,o=a.getFullYear(),i=[],n="",p="";if(s.loaded){for(var r=1;t+1>r;r++)n=s.opts.isListType?"<li"+p+">"+(o-r)+"年</li>":"<li>"+(o-r)+"</li>",i.unshift(n);for(var h=0;e>=h;h++)n=s.opts.isListType?"<li"+p+">"+(o+h)+"年</li>":"<li>"+s.dateFm(o+h)+"</li>",i.push(n);s.app_y_con.html(i.join(""))}s.currentTop=s.step*(s.opts.year-parseInt(s.app_y_con.find("li").eq(0).text())-3),s._scrollTop(s.app_y_con,-s.currentTop,!0)},s.prototype.createMonth=function(){var t=this,e=new Date,s=(t.dateFm(e.getMonth()+1),1),a=[],o="";if(t.loaded){for(;13>s;)o=t.opts.isListType?"<li>"+s+"月</li>":"<li>"+t.dateFm(s)+"</li>",a.push(o),s++;t.app_m_con.html(a.join(""))}t._scrollTop(t.app_m_con,-(t.step*parseInt(t.opts.month)-4*t.step),!0)},s.prototype.createDate=function(){var t=this,e=new Date,s=(e.getFullYear(),t.dateFm(e.getMonth()+1),t.dateFm(e.getDate()),0),a=31,o=[],i="";if(t.loaded){if(2==t.opts.month)for(a=t.opts.year%4==0&&t.opts.year%100!=0||t.opts.year%400==0?29:28;31>s;)i=s>=a?t.opts.isListType?'<li style="display:none;">'+(s+1)+"日</li>":'<li style="display:none;">'+t.dateFm(s+1)+"</li>":t.opts.isListType?"<li>"+(s+1)+"日</li>":"<li>"+t.dateFm(s+1)+"</li>",o.push(i),s++;else for(;31>s;)i=t.opts.isListType?"<li>"+(s+1)+"日</li>":"<li>"+t.dateFm(s+1)+"</li>",o.push(i),s++;t.app_d_con.html(o.join(""))}t._scrollTop(t.app_d_con,-(t.step*parseInt(t.opts.date)-4*t.step),!0)},s.prototype.createHours=function(){var t=this,e=[],s="",a=0;if(t.loaded){for(;24>a;)s=t.opts.isListType?"<li>"+a+"时</li>":"<li>"+t.dateFm(a)+"</li>",e.push(s),a++;t.app_y_con.html(e.join(""))}t.currentTop=t.step*(t.opts.hours-parseInt(t.app_y_con.find("li").eq(0).text())-3),t._scrollTop(t.app_y_con,-t.currentTop,!0)},s.prototype.createMins=function(){var t=this,e=[],s="",a=0;if(t.loaded){for(;60>a;)s=t.opts.isListType?"<li>"+a+"分</li>":"<li>"+t.dateFm(a)+"</li>",e.push(s),a++;t.app_m_con.html(e.join(""))}t._scrollTop(t.app_m_con,-(t.step*parseInt(t.opts.minutes+1)-4*t.step),!0)},s.prototype.createSeconds=function(){var t=this,e=[],s="",a=0;if(t.loaded){for(;60>a;)s=t.opts.isListType?"<li>"+a+"秒</li>":"<li>"+t.dateFm(a)+"</li>",e.push(s),a++;t.app_d_con.html(e.join(""))}t._scrollTop(t.app_d_con,-(t.step*parseInt(t.opts.seconds+1)-4*t.step),!0)},s.prototype.getYear=function(){return this.year=parseInt(this.getCurrentTXT(this.app_y_con)),this.year},s.prototype.setYear=function(t){this.year=t},s.prototype.getMonth=function(){return this.month=parseInt(this.getCurrentTXT(this.app_m_con)),this.month},s.prototype.setMonth=function(t){this.month=t},s.prototype.getDate=function(){return this.date=parseInt(this.getCurrentTXT(this.app_d_con)),this.date},s.prototype.setDate=function(t){this.date=t},s.prototype.getCurrentTXT=function(t){var e=Math.round(t.position().top)/this.step;0==e?e=3:e>=1&&3>=e?1==e?e=2:2==e?e=1:3==e&&(e=0):0>e&&(e=Math.abs(e)+3);var s=t.find("li").eq(e).text();return s},s.prototype.setCurrentTXT=function(t){var e=this,s=t,a=e.opts;s&&s.length>0&&(a.showTime?(a.hours=isNaN(parseInt(s[0]))?a.hours:parseInt(s[0]),a.minutes=isNaN(parseInt(s[1]))?a.minutes:parseInt(s[1]),a.seconds=isNaN(parseInt(s[2]))?a.seconds:parseInt(s[2])):(a.showYear||(s[0]=""),a.showDate||(s[2]=""),a.year=isNaN(parseInt(s[0]))?a.year:parseInt(s[0]),a.month=isNaN(parseInt(s[1]))?a.month:parseInt(s[1]),a.date=isNaN(parseInt(s[2]))?a.date:parseInt(s[2])));var o,i,n,p;a.showTime?(i=a.isCN?a.hours+"时":a.hours+":",n=a.isCN?a.minutes+"分":e.dateFm(a.minutes)+":",p=a.isCN?a.seconds+"秒":e.dateFm(a.seconds),o=i+n+p):(i=a.isCN?a.year+"年":a.year+a.commer,n=a.isCN?a.month+"月":e.dateFm(a.month)+a.commer,p=a.isCN?a.date+"日":e.dateFm(a.date),a.showYear&&a.showMonth&&!a.showDate?(i=a.isCN?a.year+"年":a.year+a.commer,n=a.isCN?a.month+"月":e.dateFm(a.month),p="",o=i+n):!a.showYear&&a.showMonth&&a.showDate?(i="",n=a.isCN?a.month+"月":e.dateFm(a.month)+a.commer,p=a.isCN?a.date+"日":e.dateFm(a.date),o=n+p):o=i+n+p),"INPUT"==e.selectElm.tagName?e.selectElm.value=o:e.selectElm.innerHTML=o},s.prototype.subDefaultDate=function(t){var e=this,s=[],a=e.opts;if(t||""!=t)s=a.isCN?t.match(/(\d)+/gi):t.match(/(\d)+/gi)||t.split(a.commer||"-");else{var o=new Date;a.showTime?(s.push(o.getHours()),s.push(o.getMinutes()),s.push(o.getSeconds())):(s.push(o.getFullYear()),s.push(o.getMonth()+1),s.push(o.getDate()))}return 3==s.length?(a.showYear||(s[0]=""),a.showDate||(s[2]="")):(a.showYear||s.unshift(""),a.showDate||s.push("")),e.valList=s,s},s.prototype.getCurrentDate=function(t,e,s,a){var o=this.currDate;return t&&void 0!=t&&null!=t&&0!=t?t:t=o[0],e&&void 0!=e&&null!=e&&0!=e?e:e=o[1],s&&void 0!=s&&null!=s&&0!=s?s:s=o[2],o[0]=t,o[1]=e,o[2]=s,o},s.prototype._scrollTop=function(t,s,a){var o=this,a=a?!0:a,i=o.step;a?t.off().animate({top:s},500,function(){var t=s%i;if(0!=t){var e=i*Math.round(s/i)-(Math.abs(t)<i?0:i);$(this).animate({top:e})}}):t[0].style.top=s+"px",e.isCircle===!0&&n(t,s)},s.prototype._events=function(){var t=this,e=t.opts,s=t.app_y_con,i=t.app_m_con,n=t.app_d_con,p=t.app_main;new a(s[0],p[0],e),new a(i[0],p[0],e),new a(n[0],p[0],e);t.app_btnOk.bind("touchend",o(t,t._complate)),t.app_btnCancel.bind("touchend",o(t,t._cancel)),t.app_btnOk.bind("touchstart",t.endEvent),t.app_btnCancel.bind("touchstart",t.endEvent)},s.prototype.endEvent=function(t){t.preventDefault(),t.stopPropagation()},s.prototype._complate=function(t){var e=[];e.push(this.getYear()),e.push(this.getMonth()),e.push(this.getDate()),this.currDate=e,this.setCurrentTXT(e),this.appWrap.style.display="none",this.complate.call(this,t)},s.prototype._cancel=function(t){this.appWrap.style.display="none"},s.prototype.dateFm=function(t){return 10>t?"0"+t:t},t.APPDateField=s;var a=function(t,s,a){this.elm=t,this.elmParent=s,this.hasTouch="ontouchstart"in window||window.TouchEvent,this.isMobile=/Mobile/gi.test(navigator.userAgent),this.isTouchStart=!1,this.options=a,this.vlist={year:this.options.year,month:this.options.month,date:this.options.date,hours:this.options.hours,minutes:this.options.minutes,seconds:this.options.seconds},this.startY=0,this.dy=0,this.h=$(this.elm).height(),this.moveY=0,this.top=$(this.elm).position().top,this.step=e.step,this.fontSize=e.fontSize,this.offset={left:this.elmParent.offsetLeft,top:this.elmParent.offsetTop,width:$(this.elmParent).width(),height:$(this.elmParent).height()},this.startTime=Date.now()||function(){return(new Date).getTime()}(),this._initEvent(t)};a.prototype={_initEvent:function(t){this.hasTouch?(t.addEventListener("touchstart",this,!1),t.addEventListener("touchmove",this,!1),t.addEventListener("touchend",this,!1)):(t.addEventListener("mousedown",this,!1),t.addEventListener("mousemove",this,!1),t.addEventListener("mouseup",this,!1))},handleEvent:function(t){switch(t.type){case"touchstart":this._start(t.targetTouches[0],t);break;case"touchmove":this._move(t.changedTouches[0],t);break;case"touchend":this._end(t.changedTouches[0],t);break;case"mousedown":this._start(t);break;case"mousemove":this._move(t);break;case"mouseup":this._end(t)}/SELECT|TEXTAREA|INPUT/.test(t.target.tagName.toUpperCase())&&t.preventDefault(),t.preventDefault(),t.stopPropagation()},_start:function(t,e){this.isTouchStart=!0,this.y=this.top=$(this.elm).position().top,this.h=$(this.elm).height(),this.startY=this.top,this.moveY=t.pageY,this.startTime=Date.now()||function(){return(new Date).getTime()}()},_move:function(t,s){if(this.isTouchStart){var a=$(t.target).parent("ul");a.find("li").css("fontSize",this.fontSize+"px"),this.dy=this.y-(this.moveY-t.pageY);var o=this._formateTop(this.dy);this._scrollTop(a[0],o,!0),e.isCircle===!0&&n(a,o)}},_end:function(t,s){this.isTouchStart=!1;var a=$(t.target).parent("ul"),o=t.pageY-this.moveY,i=this.y+o,p=o/((new Date).getTime()-this.startTime);Math.abs(p)>.5&&(i-=p*this.step);var r=this._formateTop(i);this._scrollTop(a[0],r,!1),e.isCircle===!0&&n(a,r)},_formateTop:function(t){if(t>=3*e.step)t=3*e.step;else{if(!(Math.abs(t)>=this.h-4*e.step))return t;t=-(this.h-4*e.step)}return this.y=t,t},_scrollTop:function(t,s,a){if(!t||""==t)return!1;var s=s||0,a=a&&!0,o=this;if(a?t.style.top=s+"px":$(t).off().animate({top:s},10,function(){var t=s%e.step;if(0!=t){var a=e.step*Math.round(s/e.step)-(Math.abs(t)<e.step?0:e.step);$(this).animate({top:a}),o.y=a}}),!o.isTouchStart){var n=i(Math.round($(t).position().top/e.step)),p=$(t).find("li").eq(n).text();if($(t).hasClass("app-dateField-month-con")){o.vlist.month=parseInt(p);var r=i(Math.round($(".app-dateField-year-con").position().top/e.step));o.vlist.year=parseInt($(".app-dateField-year-con").find("li").eq(r).text())}else if($(t).hasClass("app-dateField-year-con")){o.vlist.year=parseInt(p);var r=i(Math.round($(".app-dateField-month-con").position().top/e.step));o.vlist.month=parseInt($(".app-dateField-month-con").find("li").eq(r).text())}else{o.vlist.date=parseInt(p);var r=i(Math.round($(".app-dateField-year-con").position().top/e.step));o.vlist.year=parseInt($(".app-dateField-year-con").find("li").eq(r).text());var h=i(Math.round($(".app-dateField-month-con").position().top/e.step));o.vlist.month=parseInt($(".app-dateField-month-con").find("li").eq(h).text())}if($(t).hasClass("app-dateField-month-con")||$(t).hasClass("app-dateField-year-con")){var l=0;if(2==o.vlist.month){l=o.vlist.year%4==0&&o.vlist.year%100!=0||o.vlist.year%400==0?29:28;for(var c=0;31>c;c++)c>=l&&$(".app-dateField-date-con").find("li").eq(c).css("display","none")}else for(var c=0;31>c;c++)$(".app-dateField-date-con").find("li").eq(c).css("display","block")}}}};var o=function(t,e){for(var s=[],a=2;a<arguments.length;a++)s.push(arguments[a]);return function(a){s.push(a),e.call(t,a,s)}},i=function(t){return 0==t?t=3:t>=1&&3>=t?1==t?t=2:2==t?t=1:3==t&&(t=0):t=Math.abs(t)+3,t},n=function(t,s){var a=Math.round(s/e.step),o=Math.round(t.height()/e.step),i=e.fontSize;a>=o?a=o-1:a>=1&&3>=a?1==a?a=3-a:2==a?a=3-a:3==a&&(a=0):0>=a&&(a=Math.abs(a)+3);for(var n=0;4>n;n++){var p=t.find("li").eq(a-n);p[0]&&(p[0].style.fontSize=i+"px",i-=3)}i=e.fontSize;for(var r=0;4>r;r++){var p=t.find("li").eq(a+r);p[0]&&(p[0].style.fontSize=i+"px",i-=3)}}}).call(this);