(function(){"use strict";var t={fontSize:1.2,step:40,isCircle:!1,tpl:'<div class="app-dateField-main"><div class="app-dateField-top"><span class="app-dateField-btnCancel">取消</span><span class="app-dateField-btnOk">完成</span></div><div class="app-dateField-center"><ul class="app-dateField-year-con"></ul><ul class="app-dateField-month-con"></ul><ul class="app-dateField-date-con"></ul><div class="app-center-current"></div></div><div class="app-dateField-bottom"></div></div>'},e=function(e,s,o,a){var n=this,s=s||{};n.selectElm=$?$("#"+e)[0]:document.getElementById(e),n.htmlDom=null,n.appWrap=$?$("#APPDateField-con")[0]:document.getElementById("APPDateField-con"),n.loaded=!1,n.isRender=!1,(s.complate&&void 0!=s.complate&&"function"==typeof s.complate||o&&"function"==typeof o)&&(n.complate=s.complate?s.complate:o),(s.cancel&&void 0!=s.cancel&&"function"==typeof s.cancel||a&&"function"==typeof a)&&(n.cancel=s.cancel?s.cancel:a),n.currentTop=0,n.step=t.step,n.valList=[],n.currDate=[],n.app_top,n.app_btnCancel,n.app_btnOk,n.app_center_con,n.app_y_con,n.app_m_con,n.app_d_con,n.app_cen_c,n.opts={year:(new Date).getFullYear(),month:(new Date).getMonth()+1,date:(new Date).getDate(),hours:(new Date).getHours(),minutes:(new Date).getMinutes(),secondes:(new Date).getSeconds(),upYear:s.upYear||100,downYear:s.downYear||100,isCN:s.isCN||void 0==s.isCN?!0:s.isCN,isVal:s.isVal||void 0==s.isVal?!1:s.isVal,isCircle:s.isCircle||void 0==s.isCircle?!1:s.isCircle,showYear:s.showYear||void 0==s.showYear?!0:s.showYear,showMonth:s.showMonth||void 0==s.showMonth?!0:s.showMonth,showDate:s.showDate||void 0==s.showDate?!0:s.showDate,commer:s.commer||"-"},t.isCircle=n.opts.isCircle,n._init()};e.prototype._init=function(){var t=this;(t.selectElm.value||""!==t.selectElm.value)&&(t.valList=t.subDefaultDate(t.selectElm.value||"")),t.setCurrentTXT(t.valList),t.appWrap?($?$(t.appWrap).show():t.appWrap.style.display="block",t.isRender=!0):(t.appWrap=document.createElement("div"),t.appWrap.setAttribute("id","APPDateField-con"),t.appWrap.setAttribute("class","APPDateField-con"),document.body.appendChild(t.appWrap)),t._load()},e.prototype._load=function(){var t=this;t.loaded||t._render()},e.prototype._render=function(){function e(){s.app_center_con.find("ul").css({width:o.width()/3}),s.opts.showYear&&s.opts.showMonth&&!s.opts.showDate?(s.app_center_con.find("ul").css({width:o.width()/2}),s.app_y_con.css({left:0}),s.app_m_con.css({left:o.width()/2}),s.app_d_con.css({left:o.width()/2*2,display:"none"})):!s.opts.showYear&&s.opts.showMonth&&s.opts.showDate?(s.app_center_con.find("ul").css({width:o.width()/2}),s.app_y_con.css({left:0,display:"none"}),s.app_m_con.css({left:0}),s.app_d_con.css({left:o.width()/2})):s.opts.showYear&&s.opts.showMonth&&s.opts.showDate&&(s.app_y_con.css({left:0}),s.app_m_con.css({left:o.width()/3}),s.app_d_con.css({left:o.width()/3*2}))}var s=this,o=$(s.appWrap).html(t.tpl);s.htmlDom=o,s.app_main=o.find(".app-dateField-main"),s.app_top=o.find(".app-dateField-top"),s.app_btnCancel=o.find(".app-dateField-btnCancel"),s.app_btnOk=o.find(".app-dateField-btnOk"),s.app_center_con=o.find(".app-dateField-center"),s.app_y_con=o.find(".app-dateField-year-con"),s.app_m_con=o.find(".app-dateField-month-con"),s.app_d_con=o.find(".app-dateField-date-con"),s.app_cen_c=o.find(".app-center-current"),window.onresize=e,e(),s.loaded=!0,s.createYear(),s.createMonth(),s.createDate(),s._events()},e.prototype.createYear=function(t,e){var s=this,t=t||s.opts.upYear,e=e||s.opts.downYear,o=new Date,a=o.getFullYear(),n=[],p="",i="";if(s.loaded){for(var r=1;t+1>r;r++)p=s.opts.isCN?"<li"+i+">"+(a-r)+"年</li>":"<li>"+(a-r)+"</li>",n.unshift(p);for(var h=0;e>=h;h++)p=s.opts.isCN?"<li"+i+">"+(a+h)+"年</li>":"<li>"+s.dateFm(a+h)+"</li>",n.push(p);s.app_y_con.html(n.join(""))}s.currentTop=s.step*(s.opts.year-parseInt(s.app_y_con.find("li").eq(0).text())-3),s._scrollTop(s.app_y_con,-s.currentTop,!0)},e.prototype.createMonth=function(){var t=this,e=new Date,s=(t.dateFm(e.getMonth()+1),1),o=[],a="";if(t.loaded){for(;13>s;)a=t.opts.isCN?"<li>"+s+"月</li>":"<li>"+t.dateFm(s)+"</li>",o.push(a),s++;t.app_m_con.html(o.join(""))}t._scrollTop(t.app_m_con,-(t.step*parseInt(t.opts.month)-4*t.step),!0)},e.prototype.createDate=function(){var t=this,e=new Date,s=(e.getFullYear(),t.dateFm(e.getMonth()+1),t.dateFm(e.getDate()),0),o=31,a=[],n="";if(t.loaded){if(2==t.opts.month)for(o=t.opts.year%4==0&&t.opts.year%100!=0||t.opts.year%400==0?29:28;31>s;)n=s>=o?t.opts.isCN?'<li style="display:none;">'+(s+1)+"日</li>":'<li style="display:none;">'+t.dateFm(s+1)+"</li>":t.opts.isCN?"<li>"+(s+1)+"日</li>":"<li>"+t.dateFm(s+1)+"</li>",a.push(n),s++;else for(;31>s;)n=t.opts.isCN?"<li>"+(s+1)+"日</li>":"<li>"+t.dateFm(s+1)+"</li>",a.push(n),s++;t.app_d_con.html(a.join(""))}t._scrollTop(t.app_d_con,-(t.step*parseInt(t.opts.date)-4*t.step),!0)},e.prototype.getYear=function(){return this.year=parseInt(this.getCurrentTXT(this.app_y_con)),this.year},e.prototype.setYear=function(t){this.year=t},e.prototype.getMonth=function(){return this.month=parseInt(this.getCurrentTXT(this.app_m_con)),this.month},e.prototype.setMonth=function(t){this.month=t},e.prototype.getDate=function(){return this.date=parseInt(this.getCurrentTXT(this.app_d_con)),this.date},e.prototype.setDate=function(t){this.date=t},e.prototype.getCurrentTXT=function(t){var e=Math.round(t.position().top)/this.step;0==e?e=3:e>=1&&3>=e?1==e?e=2:2==e?e=1:3==e&&(e=0):0>e&&(e=Math.abs(e)+3);var s=t.find("li").eq(e).text();return s},e.prototype.setCurrentTXT=function(t){var e=this,s=t;s&&s.length>0&&(e.opts.showYear||(s[0]=""),e.opts.showDate||(s[2]=""),e.opts.year=isNaN(parseInt(s[0]))?e.opts.year:parseInt(s[0]),e.opts.month=isNaN(parseInt(s[1]))?e.opts.month:parseInt(s[1]),e.opts.date=isNaN(parseInt(s[2]))?e.opts.date:parseInt(s[2]));var o=e.opts.isCN?e.opts.year+"年":e.opts.year+e.opts.commer,a=e.opts.isCN?e.opts.month+"月":e.dateFm(e.opts.month)+e.opts.commer,n=e.opts.isCN?e.opts.date+"日":e.dateFm(e.opts.date);e.opts.showYear&&e.opts.showMonth&&!e.opts.showDate?(o=e.opts.isCN?e.opts.year+"年":e.opts.year+e.opts.commer,a=e.opts.isCN?e.opts.month+"月":e.dateFm(e.opts.month)+e.opts.commer,n="",e.selectElm.value=o+a):!e.opts.showYear&&e.opts.showMonth&&e.opts.showDate?(o="",a=e.opts.isCN?e.opts.month+"月":e.dateFm(e.opts.month)+e.opts.commer,n=e.opts.isCN?e.opts.date+"日":e.dateFm(e.opts.date),e.selectElm.value=a+n):e.selectElm.value=o+a+n},e.prototype.subDefaultDate=function(t){var e=this,s=[];if(t||""!=t)s=e.opts.isCN?t.match(/(\d)+/gi):t.split(e.opts.commer||"-");else{var o=new Date;s.push(o.getFullYear()),s.push(o.getMonth()+1),s.push(o.getDate())}return 3==s.length?(e.opts.showYear||(s[0]=""),e.opts.showDate||(s[2]="")):(e.opts.showYear||s.unshift(""),e.opts.showDate||s.push("")),e.valList=s,s},e.prototype.getCurrentDate=function(t,e,s,o){var a=this.currDate;return t&&void 0!=t&&null!=t&&0!=t?t:t=a[0],e&&void 0!=e&&null!=e&&0!=e?e:e=a[1],s&&void 0!=s&&null!=s&&0!=s?s:s=a[2],a[0]=t,a[1]=e,a[2]=s,a},e.prototype._scrollTop=function(t,e,s){var s=s?!0:s;s?t.stop().animate({top:e},500,function(){var t=e%self.step;if(0!=t){var s=self.step*Math.round(e/self.step)-(Math.abs(t)<self.step?0:self.step);$(this).animate({top:s})}}):t[0].style.top=e+"px",n(t,e)},e.prototype._events=function(){{var t=this,e=t.app_y_con,a=t.app_m_con,n=t.app_d_con,p=t.app_main;new s(e[0],p[0],t.opts),new s(a[0],p[0],t.opts),new s(n[0],p[0],t.opts)}t.app_btnOk.bind("touchend",o(t,t._complate)),t.app_btnCancel.bind("touchend",o(t,t._cancel)),t.app_btnOk.bind("touchstart",t.endEvent),t.app_btnCancel.bind("touchstart",t.endEvent)},e.prototype.endEvent=function(t){t.preventDefault(),t.stopPropagation()},e.prototype._complate=function(t){var e=[];e.push(this.getYear()),e.push(this.getMonth()),e.push(this.getDate()),this.currDate=e,this.setCurrentTXT(e),this.appWrap.style.display="none",this.complate.call(this,t)},e.prototype._cancel=function(t){this.appWrap.style.display="none"},e.prototype.dateFm=function(t){return 10>t?"0"+t:t};var s=function(e,s,o){this.elm=e,this.elmParent=s,this.hasTouch="ontouchstart"in window||window.TouchEvent,this.isMobile=/Mobile/gi.test(navigator.userAgent),this.isTouchStart=!1,this.options=o,this.vlist={year:this.options.year,month:this.options.month,date:this.options.date,hours:this.options.hours,minutes:this.options.minutes,seconds:this.options.seconds},this.startY=0,this.dy=0,this.h=$(this.elm).height(),this.moveY=0,this.top=$(this.elm).position().top,this.step=t.step,this.fontSize=t.fontSize,this.offset={left:this.elmParent.offsetLeft,top:this.elmParent.offsetTop,width:$(this.elmParent).width(),height:$(this.elmParent).height()},this.startTime=Date.now||function(){return(new Date).getTime()},this._initEvent(e)};s.prototype={_initEvent:function(t){this.hasTouch?(t.addEventListener("touchstart",this,!1),t.addEventListener("touchmove",this,!1),t.addEventListener("touchend",this,!1)):(t.addEventListener("mousedown",this,!1),t.addEventListener("mousemove",this,!1),t.addEventListener("mouseup",this,!1))},handleEvent:function(t){switch(t.type){case"touchstart":this._start(t.targetTouches[0],t);break;case"touchmove":this._move(t.changedTouches[0],t);break;case"touchend":this._end(t.changedTouches[0],t);break;case"mousedown":this._start(t);break;case"mousemove":this._move(t);break;case"mouseup":this._end(t)}/SELECT|TEXTAREA|INPUT/.test(t.target.tagName.toUpperCase())&&t.preventDefault(),t.preventDefault(),t.stopPropagation()},_start:function(t,e){this.isTouchStart=!0,this.y=this.top=$(this.elm).position().top,this.h=$(this.elm).height(),this.startY=this.top,this.moveY=t.pageY,this.startTime=Date.now||function(){return(new Date).getTime()}},_move:function(t,e){if(this.isTouchStart){var s=$(t.target).parent("ul");s.find("li").css("fontSize",this.fontSize+"em"),this.dy=this.y-(this.moveY-t.pageY);var o=this._formateTop(this.dy);this._scrollTop(s[0],o,!0),n(s,o)}},_end:function(t,e){this.isTouchStart=!1;var s=$(t.target).parent("ul"),o=t.pageY-this.moveY,a=this.y+o,p=o/((new Date).getTime()-this.startTime);Math.abs(p)>.5&&(a-=p*this.step);var i=this._formateTop(a);this._scrollTop(s[0],i,!1),n(s,i)},_formateTop:function(t){if(t>=3*this.step)t=3*this.step;else{if(!(Math.abs(t)>=this.h-4*this.step))return t;t=-(this.h-4*this.step)}return this.y=t,t},_scrollTop:function(t,e,s){if(!t||""==t)return!1;var e=e||0,s=s&&!0,o=this;if(s?t.style.top=e+"px":$(t).stop().animate({top:e},10,function(){var t=e%o.step;if(0!=t){var s=o.step*Math.round(e/o.step)-(Math.abs(t)<o.step?0:o.step);$(this).animate({top:s}),o.y=s}}),!o.isTouchStart){var n=a(Math.round($(t).position().top/50)),p=$(t).find("li").eq(n).text();if($(t).hasClass("app-dateField-month-con")){o.vlist.month=parseInt(p);var i=a(Math.round($(".app-dateField-year-con").position().top/o.step));o.vlist.year=parseInt($(".app-dateField-year-con").find("li").eq(i).text())}else if($(t).hasClass("app-dateField-year-con")){o.vlist.year=parseInt(p);var i=a(Math.round($(".app-dateField-month-con").position().top/o.step));o.vlist.month=parseInt($(".app-dateField-month-con").find("li").eq(i).text())}else{o.vlist.date=parseInt(p);var i=a(Math.round($(".app-dateField-year-con").position().top/o.step));o.vlist.year=parseInt($(".app-dateField-year-con").find("li").eq(i).text());var r=a(Math.round($(".app-dateField-month-con").position().top/o.step));o.vlist.month=parseInt($(".app-dateField-month-con").find("li").eq(r).text())}if($(t).hasClass("app-dateField-month-con")||$(t).hasClass("app-dateField-year-con")){var h=0;if(2==o.vlist.month){h=o.vlist.year%4==0&&o.vlist.year%100!=0||o.vlist.year%400==0?29:28;for(var l=0;31>l;l++)l>=h&&$(".app-dateField-date-con").find("li").eq(l).css("display","none")}else for(var l=0;31>l;l++)$(".app-dateField-date-con").find("li").eq(l).css("display","block")}}}};var o=function(t,e){for(var s=[],o=2;o<arguments.length;o++)s.push(arguments[o]);return function(o){s.push(o),e.call(t,o,s)}},a=function(t){return 0==t?t=3:t>=1&&3>=t?1==t?t=2:2==t?t=1:3==t&&(t=0):t=Math.abs(t)+3,t},n=function(e,s){var o=Math.round(s/t.step),a=Math.round(e.height()/t.step),n=t.fontSize;o>=a?o=a-1:o>=1&&3>=o?1==o?o=3-o:2==o?o=3-o:3==o&&(o=0):0>=o&&(o=Math.abs(o)+3);for(var p=0;4>p;p++){var i=e.find("li").eq(o-p);if(!i[0])break;i[0].style.fontSize=n+"em",n-=.3}n=t.fontSize;for(var r=0;4>r;r++){var i=e.find("li").eq(o+r);if(!i[0])break;i[0].style.fontSize=n+"em",n-=.3}};"function"==typeof define?define(function(){return e}):"undefined"!=typeof exports?module.exports=e:window.APPDateField=e}).call(this);