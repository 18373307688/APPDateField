(function(){"use strict";function t(t){return void 0!=t}function s(){}function e(t,s){for(var e=[],i=2;i<arguments.length;i++)e.push(arguments[i]);return function(i){e.push(i),s.call(t,i,e)}}function i(t,s,e,i,a){if(!t||""==t)return!1;s=s||0;var h=n.step;e=e&&!0,e?(t.style.top=s+"px",a&&o(t,i)):$(t).off().animate({top:s},10,function(){var e=s%h;if(0!=e){var n=h*Math.round(s/h)-(Math.abs(e)<h?0:h);$(this).animate({top:n},function(){a&&o(t,i)}),i.y=n}})}function o(t,s){s.isTouchStart||s.callTarget.opts.data||(s.callTarget.opts.year=s.callTarget.getYear(),s.callTarget.opts.month=s.callTarget.getMonth(),$(t).hasClass("app-s-date-con")||s.callTarget.createDate(!1))}function a(t,s,e){function i(s){function i(){u+=d,"down"===s?_+=f:_-=f}function a(){u-=d,"down"===s?_-=f:_+=f}for(var h,n,r=0,c=4,l=e.opts.fontSize,u=0,d=5,_=0,f=10;c>r;r++)n="up"===s?o-r:o+r,h=t.find("li").eq(n)[0],h&&(3===p?(h.style.cssText="font-size:"+l+"px; text-indent:"+u+"px; -webkit-transform: skewX("+_+"deg)",t.hasClass("app-s-year-con")&&i(),t.hasClass("app-s-date-con")&&a()):h.style.fontSize=l+"px",l-=4)}var o=Math.round(s/n.step),a=Math.round(t.height()/n.step);o>=a?o=a-1:o>=1&&3>=o?1==o?o=3-o:2==o?o=3-o:3==o&&(o=0):0>=o&&(o=Math.abs(o)+3);var h=e.app_center_con.find("ul").filter(function(t){return"none"!=$(this).css("display")}),p=h.length;$.each(t.find("li"),function(t,s){o-4>t||t>o+4?$(s).css("visibility","hidden"):$(s).attr("style","")}),i("up"),i("down")}var h=this,n={fontSize:22,step:40,tpl:'<div class="app-s-main"><div class="app-s-top"><span class="app-s-btnCancel">取消</span><span class="app-s-title">选择时间</span><span class="app-s-btnOk">完成</span></div><div class="app-s-center"><ul class="app-s-year-con"></ul><ul class="app-s-month-con"></ul><ul class="app-s-date-con"></ul><div class="app-center-current"></div></div><div class="app-s-bottom"></div></div>'},p=Object.prototype.toString,r=function(e,i,o,a){i=i||{},this.selectElm=$("#"+e.replace(/^#/i,""))[0],this.appWrap=$("#app-s-con"),this.loaded=!1,(i.complete&&t(i.complete)&&"function"==typeof i.complete||o&&"function"==typeof o)&&(this.complete=i.complete||o||s),(i.cancel&&t(i.cancel)&&"function"==typeof i.cancel||a&&"function"==typeof a)&&(this.cancel=i.cancel||a||s),this.step=n.step,this.valList=[],this.currDate=[],this.opts={year:(new Date).getFullYear(),month:(new Date).getMonth()+1,date:(new Date).getDate(),hours:(new Date).getHours(),minutes:(new Date).getMinutes(),seconds:(new Date).getSeconds(),upYear:"number"==typeof i.downYear?i.downYear:60,downYear:"number"==typeof i.downYear?i.downYear:60,data:i.data,title:i.title||"",addClass:i.addClass||"",fontSize:i.fontSize||n.fontSize,cancelTxt:i.cancelTxt||"取消",completeTxt:i.completeTxt||"完成",isCN:t(i.isCN)?i.isCN:!0,isCircle:t(i.isCircle)?i.isCircle:!0,showYear:t(i.showYear)?i.showYear:!0,showMonth:t(i.showMonth)?i.showMonth:!0,showDate:t(i.showDate)?i.showDate:!0,showTime:i.showTime||!1,commer:i.commer||"-"},this._init()};r.prototype._init=function(){var t=this._getValue();this.opts.data?this.valList=t:(t&&""!==t&&(this.valList=this.subDefaultDate(t||"")),this.setCurrentTXT(this.valList)),this.appWrap[0]?this.appWrap.fadeIn(10):(this.appWrap=$("<div />").attr({id:"app-s-con","class":"app-s-con"}),$("body").append(this.appWrap)),this._load()},r.prototype._load=function(){this._render()},r.prototype._render=function(){var t=this.appWrap.html(n.tpl);this.app_main=t.find(".app-s-main"),this.app_title=t.find(".app-s-title"),this.app_btnCancel=t.find(".app-s-btnCancel"),this.app_btnOk=t.find(".app-s-btnOk"),this.app_center_con=t.find(".app-s-center"),this.app_y_con=t.find(".app-s-year-con"),this.app_m_con=t.find(".app-s-month-con"),this.app_d_con=t.find(".app-s-date-con");var s=t.width();return this.app_title.html(this.opts.title),this.app_btnCancel.html(this.opts.cancelTxt),this.app_btnOk.html(this.opts.completeTxt),this.opts.data?(this.app_y_con.css({width:s,left:0}),this.app_m_con.css("display","none"),this.app_d_con.css("display","none"),this.loaded=!0,this.createDatas(),this.opts.data&&this._events(),!1):(this.app_center_con.find("ul").css("width",s/3),this.opts.showYear&&this.opts.showMonth&&this.opts.showDate?(this.app_y_con.css("left",0),this.app_m_con.css("left",s/3),this.app_d_con.css("left",s/3*2)):this.opts.showYear&&this.opts.showMonth&&!this.opts.showDate?(this.app_center_con.find("ul").css("width",s/2),this.app_y_con.css("left",0),this.app_m_con.css("left",s/2),this.app_d_con.css({left:s/2*2,display:"none"})):!this.opts.showYear&&this.opts.showMonth&&this.opts.showDate&&(this.app_center_con.find("ul").css("width",s/2),this.app_y_con.css({left:0,display:"none"}),this.app_m_con.css("left",0),this.app_d_con.css("left",s/2)),this.loaded=!0,this.opts.showTime?(this.createHours(),this.createMins(),this.createSeconds()):(this.createYear(),this.createMonth(),this.createDate()),void this._events())},r.prototype.createDatas=function(){var t=this.opts.data,s=[],e="",i=1,o=0;if(this.loaded){if("[object Object]"===p.call(t))for(var a in t)e='<li style="font-size:'+this.opts.fontSize+'px;" data-key="'+a+'">'+t[a]+"</li>",s.push(e),this.valList==t[a]&&(i=o+1),o++;else{if("[object Array]"!==p.call(t))throw new ReferenceError("data parameter must be an array or object");for(var h=t.length;h>o;o++)e='<li style="font-size:'+this.opts.fontSize+'px;">'+t[o]+"</li>",s.push(e),this.valList==t[o]&&(i=o+1)}this.app_y_con.html(s.join(""));var n=this.step*parseInt(i)-4*this.step;this._scrollTop(this.app_y_con,-n,!0)}},r.prototype.createYear=function(t,s){if(this.loaded){for(var t=t||this.opts.upYear,s=s||this.opts.downYear,e=new Date,i=e.getFullYear(),o=[],a="",h="",n=1;t+1>n;n++)a=this.opts.isCN?"<li"+h+">"+(i-n)+"年</li>":"<li>"+(i-n)+"</li>",o.unshift(a);for(var p=0;s>=p;p++)a=this.opts.isCN?"<li"+h+">"+(i+p)+"年</li>":"<li>"+this.dateFm(i+p)+"</li>",o.push(a);this.app_y_con.html(o.join(""));var r=this.step*(this.opts.year-parseInt(this.app_y_con.find("li").eq(0).text())-3);this._scrollTop(this.app_y_con,-r)}},r.prototype.createMonth=function(){this._createLists(this.app_m_con,1,13,this.opts.month);var t=this.step*parseInt(this.opts.month)-4*this.step;this._scrollTop(this.app_m_con,-t)},r.prototype.createDate=function(t){var s=0,e=31,i=[1,3,5,7,8,10,12],o=[4,6,9,11],a=this.opts.month,h=[],n="";if(this.loaded){for(-1!==i.indexOf(a)?e=31:-1!==o.indexOf(a)?e=30:2==a&&(e=this.opts.year%4==0&&this.opts.year%100!=0||this.opts.year%400==0?29:28);e>s;)n=this.opts.isCN?"<li>"+(s+1)+"日</li>":"<li>"+this.dateFm(s+1)+"</li>",h.push(n),s++;this.app_d_con.html(h.join("")),this._scrollTop(this.app_d_con,-(this.step*parseInt(this.opts.date)-4*this.step),t)}},r.prototype.createHours=function(){this._createLists(this.app_y_con,0,24,this.opts.hours);var t=this.step*(this.opts.hours-parseInt(this.app_y_con.find("li").eq(0).text())-3);this._scrollTop(this.app_y_con,-t)},r.prototype.createMins=function(){this._createLists(this.app_m_con,0,60,this.opts.minutes);var t=this.step*parseInt(this.opts.minutes+1)-4*this.step;this._scrollTop(this.app_m_con,-t)},r.prototype.createSeconds=function(){this._createLists(this.app_d_con,0,60,this.opts.minutes);var t=this.step*parseInt(this.opts.seconds+1)-4*this.step;this._scrollTop(this.app_d_con,-t)},r.prototype._createLists=function(t,s,e,i){if(this.loaded){var o=[],a="",h=this.opts.isCN,n="";switch(i){case this.opts.month:n="月";break;case this.opts.date:n="日";break;case this.opts.hours:n="时";break;case this.opts.minutes:n="分";break;case this.opts.secondes:n="秒"}for(;e>s;)a=h?"<li>"+s+n+"</li>":"<li>"+this.dateFm(s)+"</li>",o.push(a),s++;t.html(o.join(""))}},r.prototype.getYear=function(){return this._getText(this.app_y_con)},r.prototype.getMonth=function(){return this._getText(this.app_m_con)},r.prototype.getDate=function(){return this._getText(this.app_d_con)},r.prototype._getText=function(t){var s=parseInt(this.getCurrChangeElm(t).text());switch(t){case this.app_y_con:this[this.opts.showTime?"hours":"year"]=s;break;case this.app_m_con:this[this.opts.showTime?"minutes":"month"]=s;break;case this.app_d_con:this[this.opts.showTime?"seconds":"date"]=s}return s},r.prototype.getCurrChangeElm=function(t){var s,e=Math.round(t.position().top)/this.step;return 0==e?e=3:e>=1&&3>=e?1==e?e=2:2==e?e=1:3==e&&(e=0):0>e&&(e=Math.abs(e)+3),s=t.find("li").eq(e)},r.prototype.setCurrentTXT=function(t){function s(t,s,i){return o.isCN?t+s:e.dateFm(t)+i}var e=this,i=t,o=e.opts;if(e.opts.data)return this._setValue(t),this;if(!i||!t.length||0===i.length)return this._setValue(""),this;var a=parseInt(i[0]),h=parseInt(i[1]),n=parseInt(i[2]);o.showTime?(o.hours=a||o.hours,o.minutes=h||o.minutes,o.seconds=n||o.seconds):(o.showYear||(i[0]=""),o.showDate||(i[2]=""),o.year=a||o.year,o.month=h||o.month,o.date=n||o.date);var p,r,c,l;o.showTime?p=s(o.hours,"时",":")+s(o.minutes,"分",":")+s(o.seconds,"分",""):(r=s(o.year,"年",o.commer),c=s(o.month,"月",o.commer),l=s(o.date,"日",""),p=o.showYear&&o.showMonth&&!o.showDate?r+c.replace(o.commer,""):!o.showYear&&o.showMonth&&o.showDate?c+l:r+c+l),this._setValue(p)},r.prototype._setValue=function(t){/INPUT/gi.test(this.selectElm.tagName)?this.selectElm.value=t:this.selectElm.innerHTML=t},r.prototype._getValue=function(){return/INPUT/gi.test(this.selectElm.tagName)?this.selectElm.value:this.selectElm.innerHTML},r.prototype.subDefaultDate=function(t){var s=this,e=[],i=s.opts;if(t||""!=t)e=i.isCN?t.match(/(\d)+/gi):t.match(/(\d)+/gi)||t.split(i.commer||"-");else{var o=new Date;i.showTime?(e.push(o.getHours()),e.push(o.getMinutes()),e.push(o.getSeconds())):(e.push(o.getFullYear()),e.push(o.getMonth()+1),e.push(o.getDate()))}return 3==e.length?(i.showYear||(e[0]=""),i.showDate||(e[2]="")):(i.showYear||e.unshift(""),i.showDate||e.push("")),s.valList=e,e},r.prototype.getCurrentDate=function(t,s,e){if(this.opts.data)return this.currDate;var i=this.currDate;return i[0]=t||i[0],i[1]=s||i[1],i[2]=e||i[2],this.currDate=i,i},r.prototype._scrollTop=function(t,s){i(t[0],s,!1,this,!1),this.opts.isCircle===!0&&a(t,s,this)},r.prototype._events=function(){var t=this.opts,s=this.app_y_con,i=this.app_m_con,o=this.app_d_con,a=this.app_main;this.opts.data?new c(s[0],a[0],t,this):((this.opts.showYear||this.opts.showTime)&&new c(s[0],a[0],t,this),(this.opts.showMonth||this.opts.showTime)&&new c(i[0],a[0],t,this),(this.opts.showDate||this.opts.showTime)&&new c(o[0],a[0],t,this)),this.app_btnOk.bind("touchend",e(this,this._complete)),this.app_btnCancel.bind("touchend",e(this,this._cancel)),this.app_btnOk.bind("touchstart",this.endEvent),this.app_btnCancel.bind("touchstart",this.endEvent)},r.prototype.endEvent=function(t){t.preventDefault(),t.stopPropagation()},r.prototype._complete=function(t){var s;if(this.opts.data){var e=this.getCurrChangeElm(this.app_y_con);s=e.text(),this.changeElement=e[0]}else s=[],s.push(this.getYear()),s.push(this.getMonth()),s.push(this.getDate());this.currDate=s,this.setCurrentTXT(s),this._hide(),this.complete.call(this,t)},r.prototype._cancel=function(t){this._hide()},r.prototype._hide=function(){this.appWrap.css("display","none")},r.prototype.dateFm=function(t){return 10>t?"0"+t:t},h.APPDateField=r;var c=function(t,s,e,i){this.elm=t,this.elmParent=s,this.hasTouch="ontouchstart"in window||window.TouchEvent,this.isTouchStart=!1,this.options=e,this.callTarget=i,this.vlist={year:this.options.year,month:this.options.month,date:this.options.date,hours:this.options.hours,minutes:this.options.minutes,seconds:this.options.seconds},this.dy=0,this.h=$(this.elm).height(),this.moveY=0,this.top=$(this.elm).position().top,this.step=n.step,this.fontSize=this.callTarget.opts.fontSize,this.offset={left:this.elmParent.offsetLeft,top:this.elmParent.offsetTop,width:$(this.elmParent).width(),height:$(this.elmParent).height()},this.startTime=0,this._initEvent(t)};c.prototype={_initEvent:function(t){this.hasTouch?(t.addEventListener("touchstart",this,!1),t.addEventListener("touchmove",this,!1),t.addEventListener("touchend",this,!1)):(t.addEventListener("mousedown",this,!1),t.addEventListener("mousemove",this,!1),t.addEventListener("mouseup",this,!1))},handleEvent:function(t){switch(t.type){case"touchstart":this._start(t.targetTouches[0],t);break;case"touchmove":this._move(t.changedTouches[0],t);break;case"touchend":this._end(t.changedTouches[0],t);break;case"mousedown":this._start(t);break;case"mousemove":this._move(t);break;case"mouseup":this._end(t)}/SELECT|TEXTAREA|INPUT/.test(t.target.tagName.toUpperCase())&&t.preventDefault(),t.preventDefault(),t.stopPropagation()},_start:function(t){this.isTouchStart=!0,this.y=this.top=$(this.elm).position().top,this.h=$(this.elm).height(),this.moveY=t.pageY,this.startTime=Date.now()},_move:function(t){if(this.isTouchStart){var s=$(t.target).parent("ul");s.find("li").css("fontSize",this.fontSize+"px"),this.dy=this.y-(this.moveY-t.pageY);var e=this._formateTop(this.dy);this._scrollTop(s[0],e,!0),this.callTarget.opts.isCircle===!0&&a(s,e,this.callTarget)}},_end:function(t){this.isTouchStart=!1;var s=$(t.target).parent("ul"),e=t.pageY-this.moveY,i=this.y+e,o=this._formateTop(i);this._scrollTop(s[0],o,!1),this.callTarget.opts.isCircle===!0&&a(s,o,this.callTarget)},_formateTop:function(t){if(t>=3*n.step)t=3*n.step;else{if(!(Math.abs(t)>=this.h-4*n.step))return t;t=-(this.h-4*n.step)}return this.y=t,t},_scrollTop:function(t,s,e){var o=!this.callTarget.opts.showTime;i(t,s,e,this,o)}}}).call(this);